# edge

## 要求3

> 提取ROI中甲状腺结节的边缘、分辨边缘的规则程度、清晰程度
> 

### 边缘提取

1. 在要求1中获取到了结节区域，根据像素值转化为二值图像，使用canny算子提取出结节边缘

### 规则程度

1. 根据结节边缘提取出结节轮廓
2. 得出原始轮廓的凸包，计算凸包面积和原始轮廓面积
3. 设定一个阈值（百分比），若凸包和原始轮廓的面积差大于原始轮廓面积的阈值百分比，则边缘不光滑，反之光滑

### 清晰程度

1. 根据结节边缘提取出结节轮廓，将轮廓绘制在空白图像上
2. 计算出膨胀算子大小（与轮廓长度呈线性关系），对轮廓进行膨胀操作，使之能够覆盖轮廓周围的区域
3. 制作膨胀后的轮廓掩码，将掩码应用到原图上，得到轮廓的ROI，并对ROI大小进行归一化操作
4. 计算出ROI中的灰度梯度均值，和清晰度阈值进行比较，若低于阈值，则边缘清晰，反之不清晰。

## 要求9

> 判断结节的边缘是光滑还是毛刺状、结节形状的细节特征
> 

### 光滑/毛刺

在[要求3](#要求3)的[规则程度](#规则程度)判断中，已经能够分辨出结节边缘为光滑还是不光滑。对于不光滑的结节，进行进一步讨论，判断结节的形状特征。

### 形状细节特征

若边缘不光滑，进行如下操作：

1. 计算边缘的凸包和凸缺陷
2. 遍历所有凸缺陷，计算凸缺陷的深度、夹角大小，记录最大深度和对应角度，并将深度累加计算总深度。
3. 计算平均深度（总深度除以凸缺陷的数量），归一化深度（平均深度除以边缘周长）。
4. 按以下优先度判断边缘类型：
    1. 如果存在角度小于90度，且实际深度大于0.5mm，则为成角。
    2. 如果最大深度对应的角度大于90度，则为分叶。
    3. 如果归一化深度大于一定阈值，则为毛刺，否则为毛糙。

## 要求8

> 报告生成、导出功能
> 

### 报告生成

使用[Reportlab](https://www.reportlab.com/)库生成含有文字和图片的报告PDF文件。

### 报告内容

报告中除了患者的基本信息外，涵盖了超声位置、甲状腺基本信息、和结节基本信息，结节基本信息主要说明了大小、内部结构、边缘特征、声晕和钙化。C-TIRDS等级下也标出了相应阳性指标。